---
// src/pages/blog.astro

import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import SearchablePostGrid from '../components/SearchablePostGrid.astro';

/**
 * Fetches all blog posts from the content collection and sorts them
 * in descending order by publication date.
 */
const allPosts = await getCollection('blog');
allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout title="Blog">
  <main class="container my-5">
    <section>
      <div class="text-center mb-5">
        <h1 class="display-5">Blog</h1>
        <p class="lead">Artykuły, przemyślenia i tutoriale.</p>
      </div>

      {/**
       * The SearchablePostGrid component encapsulates all logic for displaying
       * the post grid and handling the client-side search functionality.
       * We pass the fetched and sorted posts as a prop.
       */}
      <SearchablePostGrid posts={allPosts} />
    </section>
  </main>

  {/**
   * The Pagefind UI script is loaded here, on the page where the search
   * functionality is used. It is a prerequisite for the dynamic `import()`
   * call within the SearchablePostGrid component.
   * Loading it as a module is the recommended approach.
   */}
  <script src="/pagefind/pagefind.js" type="module"></script>
</Layout>
