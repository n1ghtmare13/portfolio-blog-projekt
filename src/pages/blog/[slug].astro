---
// File: src/pages/blog/[slug].astro

import Layout from '../../layouts/Layout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import Giscus from '../../components/Giscus.astro';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  return allPosts.map((post: CollectionEntry<'blog'>) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { Content } = await post.render();

const ogImageUrl = new URL(post.data.coverImage.src, Astro.site);
---

}
<Layout
  title={post.data.title}
  description={post.data.description}
  ogImage={ogImageUrl}
  ogType="article"
>
  <Fragment slot="head">
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'BlogPosting',
        headline: post.data.title,
        description: post.data.description,
        image: ogImageUrl.href,
        datePublished: post.data.pubDate.toISOString(),
        author: {
          '@type': 'Person',
          name: 'Jacek Kucharski',
          url: new URL('/o-mnie', Astro.site).href,
        },
      })}
    />
  </Fragment>

  <main class="container my-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        {
          post.data.coverImage && (
            <Image
              src={post.data.coverImage}
              alt={post.data.coverAlt}
              widths={[800, 1200]}
              sizes="(max-width: 800px) 100vw, 800px"
              priority
              format="avif"
              quality={80}
              class="img-fluid rounded mb-4"
              transition:name={`blog-image-${post.slug}`}
            />
          )
        }

        <article class="prose">
          <h1 class="display-4">{post.data.title}</h1>
          <p class="text-muted">
            Opublikowano: {
              post.data.pubDate.toLocaleDateString('pl-PL', {
                day: 'numeric',
                month: 'long',
                year: 'numeric',
              })
            }
          </p>
          <hr />

          <div data-pagefind-ignore>
            <Content />
          </div>

          <hr class="my-5" />
          <h2 class="mb-4">Komentarze</h2>
          <Giscus />
        </article>
      </div>
    </div>
  </main>
</Layout>
